---
phase: 04-ai-analysis
plan: 03
type: execute
wave: 3
depends_on: ["04-02"]
files_modified:
  - src/components/ui/collapsible.tsx
  - src/components/analysis/analysis-progress.tsx
  - src/components/analysis/lead-score-card.tsx
autonomous: true

must_haves:
  truths:
    - "User sees analysis progress while AI is processing"
    - "User sees their lead score with color-coded fit indication"
    - "User sees ICP match percentage alongside lead score"
  artifacts:
    - path: "src/components/ui/collapsible.tsx"
      provides: "Radix Collapsible wrapper"
      exports: ["Collapsible", "CollapsibleContent", "CollapsibleTrigger"]
    - path: "src/components/analysis/analysis-progress.tsx"
      provides: "Analysis progress indicator with 4 steps"
      exports: ["AnalysisProgress"]
    - path: "src/components/analysis/lead-score-card.tsx"
      provides: "Main score display with ICP match"
      exports: ["LeadScoreCard"]
  key_links:
    - from: "src/components/analysis/analysis-progress.tsx"
      to: "/api/analyze"
      via: "POST fetch on mount"
      pattern: "fetch.*api/analyze"
    - from: "src/components/analysis/lead-score-card.tsx"
      to: "src/lib/analysis/schemas.ts"
      via: "Type imports and getScoreLabel"
      pattern: "getScoreLabel|AnalysisResult"
---

<objective>
Build core analysis UI components: progress indicator and lead score display.

Purpose: Users need to see analysis progress and the primary lead score result.

Output: Collapsible UI component, analysis progress indicator, and lead score card.
</objective>

<execution_context>
@C:\Users\farre\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\farre\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-ai-analysis/04-CONTEXT.md
@.planning/phases/04-ai-analysis/04-RESEARCH.md
@.planning/phases/04-ai-analysis/04-01-SUMMARY.md
@.planning/phases/04-ai-analysis/04-02-SUMMARY.md

@src/lib/analysis/schemas.ts
@src/components/ui/card.tsx
@src/components/analyze/extraction-progress.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add Collapsible UI Component</name>
  <files>src/components/ui/collapsible.tsx</files>
  <action>
Add shadcn Collapsible component. Run:
```bash
npx shadcn@latest add collapsible
```

If CLI fails (known Windows issue), create manually:
```typescript
"use client"

import * as CollapsiblePrimitive from "@radix-ui/react-collapsible"

const Collapsible = CollapsiblePrimitive.Root
const CollapsibleTrigger = CollapsiblePrimitive.CollapsibleTrigger
const CollapsibleContent = CollapsiblePrimitive.CollapsibleContent

export { Collapsible, CollapsibleTrigger, CollapsibleContent }
```

Install radix dependency if not present:
```bash
npm install @radix-ui/react-collapsible
```
  </action>
  <verify>
Import test: `import { Collapsible } from '@/components/ui/collapsible'` compiles.
Run `npx tsc --noEmit`.
  </verify>
  <done>
Collapsible component exists and can be imported.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create Analysis Progress Component</name>
  <files>src/components/analysis/analysis-progress.tsx</files>
  <action>
Create analysis progress indicator following ExtractionProgress pattern.

Steps to show:
1. "Analyzing company data"
2. "Scoring against ICP"
3. "Generating pitches"
4. "Predicting objections"

Props:
```typescript
interface AnalysisProgressProps {
  companyData: PartialCompanyData;
  onComplete: (result: { analysisId: string; analysis: AnalysisResult }) => void;
  onError: (error: string) => void;
}
```

Behavior:
- On mount, POST to /api/analyze with companyData
- Animate through steps while waiting
- Call onComplete with result on success
- Call onError with message on failure

Use same visual pattern as ExtractionProgress:
- Progress bar at top
- Step list with icons (Loader2, Check, AlertCircle)
- Step status: pending/running/success/failed

Add "use client" directive.
  </action>
  <verify>
Component renders without errors.
Steps animate correctly when mounted.
  </verify>
  <done>
Analysis progress shows 4 steps and calls API on mount.
  </done>
</task>

<task type="auto">
  <name>Task 3: Create Lead Score Card Component</name>
  <files>src/components/analysis/lead-score-card.tsx</files>
  <action>
Create main score display component per CONTEXT.md decisions.

Props:
```typescript
interface LeadScoreCardProps {
  leadScore: number;
  icpMatchPercentage: number;
  companyName: string;
}
```

Layout:
- Large bold score number (text-6xl font-bold)
- Color based on score:
  - >= 70: text-green-600
  - >= 40: text-yellow-600
  - < 40: text-red-600
- Score label underneath ("Strong Fit" / "Moderate Fit" / "Weak Fit")
- ICP Match percentage displayed alongside (e.g., "82% ICP Match")
- Company name as subtitle

Use Card wrapper from @/components/ui/card.
Import getScoreLabel from @/lib/analysis/schemas.

Create helper functions in component or import from schemas:
```typescript
function getScoreColor(score: number): string {
  if (score >= 70) return 'text-green-600';
  if (score >= 40) return 'text-yellow-600';
  return 'text-red-600';
}
```
  </action>
  <verify>
Component renders with sample props.
Colors change correctly at thresholds (70, 40).
  </verify>
  <done>
Lead score displays as large colored number with label and ICP match percentage.
  </done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes
2. Collapsible component is functional
3. Analysis progress animates through steps
4. Lead score shows correct colors at thresholds
5. All components can be imported
</verification>

<success_criteria>
- Collapsible available for score breakdown
- Progress indicator matches extraction flow UX
- Score card shows large number with appropriate color
- ICP match percentage visible alongside lead score
</success_criteria>

<output>
After completion, create `.planning/phases/04-ai-analysis/04-03-SUMMARY.md`
</output>
