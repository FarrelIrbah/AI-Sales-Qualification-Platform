---
phase: 02-icp-onboarding
plan: 02
type: execute
wave: 2
depends_on: ["02-01"]
files_modified:
  - src/components/ui/textarea.tsx
  - src/components/ui/progress.tsx
  - src/components/ui/select.tsx
  - src/components/ui/badge.tsx
  - src/components/onboarding/icp-wizard.tsx
  - src/components/onboarding/steps/company-info-step.tsx
  - src/components/onboarding/steps/target-criteria-step.tsx
  - src/components/onboarding/ai-input.tsx
autonomous: true

must_haves:
  truths:
    - "User can enter company information in wizard step 1"
    - "User can enter target criteria in wizard step 2"
    - "User can use natural language input with AI parsing"
    - "Wizard shows clear progress indication"
  artifacts:
    - path: "src/components/onboarding/icp-wizard.tsx"
      provides: "Main wizard container with step navigation"
      min_lines: 50
    - path: "src/components/onboarding/steps/company-info-step.tsx"
      provides: "Step 1 form fields"
      exports: ["CompanyInfoStep"]
    - path: "src/components/onboarding/steps/target-criteria-step.tsx"
      provides: "Step 2 form fields"
      exports: ["TargetCriteriaStep"]
    - path: "src/components/onboarding/ai-input.tsx"
      provides: "Natural language input with AI parse button"
      exports: ["AiInput"]
  key_links:
    - from: "src/components/onboarding/icp-wizard.tsx"
      to: "react-hook-form"
      via: "FormProvider"
      pattern: "FormProvider"
    - from: "src/components/onboarding/ai-input.tsx"
      to: "src/lib/ai/prompts/icp-parser.ts"
      via: "server action calls"
      pattern: "parseAction"
---

<objective>
Create the ICP wizard UI with steps 1-2 (Company Info and Target Criteria) and AI-powered natural language input.

Purpose: Build the first half of the wizard allowing users to describe their company and ideal customer criteria. Includes the AI input component that will be reused across all steps.

Output: Wizard container with progress indicator, two working steps with form validation, and AI-enhanced input component.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/02-icp-onboarding/02-RESEARCH.md
@.planning/phases/02-icp-onboarding/02-01-SUMMARY.md
@src/components/ui/form.tsx
@src/lib/validations/icp.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create UI components (textarea, progress, select, badge)</name>
  <files>
    src/components/ui/textarea.tsx
    src/components/ui/progress.tsx
    src/components/ui/select.tsx
    src/components/ui/badge.tsx
  </files>
  <action>
Create shadcn-style UI components following the existing patterns in src/components/ui/.

1. `textarea.tsx`: Simple textarea with Tailwind styling
   - Extends HTMLTextAreaElement
   - Supports className merging with cn()
   - Focus ring styles matching input.tsx

2. `progress.tsx`: Progress bar and step indicator
   - Progress: Simple bar with percentage fill
   - StepIndicator: Numbered circles with connecting lines, current/completed states
   - Props: currentStep, totalSteps, optional stepLabels

3. `select.tsx`: Radix UI select component
   - Install: `npm install @radix-ui/react-select`
   - SelectTrigger, SelectContent, SelectItem, SelectValue
   - Match existing shadcn styling patterns

4. `badge.tsx`: Simple badge for tags/labels
   - Variants: default, secondary, outline
   - Used for displaying selected industries, tech requirements, etc.

Follow the exact patterns from existing components (forwardRef, cn utility, proper TypeScript types).
  </action>
  <verify>
Import each component in a test file to verify no TypeScript errors. Components should match existing shadcn patterns.
  </verify>
  <done>
4 UI components created following shadcn patterns, all exportable and typed correctly.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create ICP wizard container and AI input component</name>
  <files>
    src/components/onboarding/icp-wizard.tsx
    src/components/onboarding/ai-input.tsx
  </files>
  <action>
Create `src/components/onboarding/icp-wizard.tsx`:
- "use client" directive (client component for form state)
- Use react-hook-form with FormProvider pattern
- Resolver: zodResolver with fullIcpSchema from validations/icp.ts
- State: current step (1-4), form loading state
- Functions:
  - validateCurrentStep(): trigger validation for current step's fields only
  - handleNext(): validate then increment step
  - handleBack(): decrement step (no validation needed)
  - handleSubmit(): final submission
- UI structure:
  - StepIndicator showing progress (4 steps)
  - Step labels: "Your Company", "Target Customers", "Value Props", "Objections"
  - Conditional rendering of step components
  - Navigation buttons (Back/Next/Submit)
- Default values for all form fields (empty strings, empty arrays)

Create `src/components/onboarding/ai-input.tsx`:
- "use client" directive
- Props:
  - placeholder: string
  - parseAction: (input: string) => Promise<Record<string, any>>
  - fieldMappings: Record<string, string> (AI field -> form field)
  - onParseComplete?: () => void
- State: naturalInput (textarea value), isParsing (loading)
- Use useFormContext() to access form setValue
- On "Extract with AI" button click:
  - Call parseAction with naturalInput
  - Map returned fields to form using setValue()
  - Clear naturalInput after successful parse
- Show loading spinner during parsing
- Disable button when empty or parsing
- Graceful error handling: show toast or inline error if parsing fails
  </action>
  <verify>
Render wizard in isolation to confirm step navigation works. Test that AI input calls the parse function (can mock it for testing).
  </verify>
  <done>
ICP wizard with 4-step navigation and AI input component with FormProvider integration.
  </done>
</task>

<task type="auto">
  <name>Task 3: Create Step 1 (Company Info) and Step 2 (Target Criteria) components</name>
  <files>
    src/components/onboarding/steps/company-info-step.tsx
    src/components/onboarding/steps/target-criteria-step.tsx
  </files>
  <action>
Create `src/components/onboarding/steps/company-info-step.tsx`:
- "use client" directive
- Use useFormContext() to access form methods
- Fields:
  - productDescription: Textarea with AiInput option
  - industry: Text input
  - companySize: Select dropdown (solo, small, medium, large, enterprise)
  - targetMarket: Select dropdown (b2b, b2c, both)
- AI input at top: "Describe your company in a few sentences..."
- Include parseCompanyInfo as the parseAction
- Field mappings to auto-fill form fields from AI output
- Use Form, FormField, FormItem, FormLabel, FormControl, FormMessage from ui/form.tsx
- Show validation errors inline

Create `src/components/onboarding/steps/target-criteria-step.tsx`:
- "use client" directive
- Use useFormContext() to access form methods
- Fields:
  - idealCompanySizes: Multi-select or checkbox group
  - targetIndustries: Array input (add/remove badges)
  - targetLocations: Array input (add/remove badges)
  - techRequirements: Array input (add/remove badges)
  - budgetRange: Optional min/max number inputs
- AI input at top: "Describe your ideal customer..."
- Include parseTargetCriteria as the parseAction
- For array fields, create a reusable TagInput component:
  - Text input with "Add" button
  - Display added items as badges with X to remove
  - Update form value on add/remove
- Use Form components from ui/form.tsx

Create server actions in `src/lib/icp/actions.ts` for AI parsing:
- 'use server' directive
- Wrap each parsing function with auth check (createClient, getUser)
- Export: parseCompanyInfoAction, parseTargetCriteriaAction
- These call the lib/ai/prompts functions and handle errors
  </action>
  <verify>
Render each step in isolation with FormProvider wrapper. Verify fields render, validation fires, AI input triggers action.
  </verify>
  <done>
Steps 1-2 implemented with form fields, validation, and AI-enhanced input options.
  </done>
</task>

</tasks>

<verification>
1. `npm run build` passes without errors
2. ICP wizard renders with 4-step progress indicator
3. Step 1 shows company info fields with working validation
4. Step 2 shows target criteria fields with array/tag inputs
5. AI input component calls server action and populates form fields
6. Navigation between steps 1-2 works correctly
</verification>

<success_criteria>
- Wizard container with step state management and progress indicator
- Step 1: Company info form with all 4 fields validated
- Step 2: Target criteria form with array inputs (tags/badges)
- AI input component populates form fields from natural language
- Server actions wrap AI parsing with auth check
- All components use existing UI patterns (Form, FormField, etc.)
</success_criteria>

<output>
After completion, create `.planning/phases/02-icp-onboarding/02-02-SUMMARY.md`
</output>
